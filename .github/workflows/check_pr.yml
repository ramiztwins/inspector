name: Check Pull Request

on:
  pull_request:
    branches:
      - main

permissions:
  pull-requests: write
  contents: read
  actions: write

jobs:
  check-changes:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      with:
        fetch-depth: 0  

    - name: Verify changes
      id: check_changes
      run: |
        echo "üîç Checking modified files..."
        git diff --name-only ${{ github.event.before }} ${{ github.sha }} > modified_files.txt
        cat modified_files.txt

        if grep -qv '^config.prod.json$' modified_files.txt; then
          echo "‚ùå Changes detected outside config.prod.json!" 
          echo "üõë Only modifications to config.prod.json are allowed in this pull request."
          exit 1
        fi

    - name: Trigger validation workflow
      if: success()
      uses: benc-uk/workflow-dispatch@v1
      with:
        workflow: 'validate_config.yml'
        ref: ${{ github.ref }}