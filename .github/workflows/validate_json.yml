name: Validate JSON

on:
  push:
    paths:
      - '*.json'
  pull_request:
    paths:
      - '*.json'

jobs:
  validate-json:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Install Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '14'

    - name: Install dependencies
      run: npm install -g ajv-cli

    - name: Validate JSON files
      run: |
        for file in *.json; do
          [ "$file" = "schema.json" ] && continue
          echo -n "🔍 Validating $file... "
          if jq empty "$file" > /dev/null 2>&1; then
            ajv validate -s schema.json -d "$file" --errors=json > validation_output.json 2>&1
            if [ $? -ne 0 ]; then
              echo "❌ Validation failed"
              cat validation_output.json
            else
              echo "✅ Valid"
            fi
          else
            echo "🚫 Syntax Error"
          fi
        done